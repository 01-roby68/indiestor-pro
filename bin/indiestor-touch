#!/bin/sh
#------------------------------------------------------------
# Indiestor program
# Concept, requirements, specifications, and unit testing
# By Alex Gardiner, alex@indiestor.com
# Written by Erik Poupaert, erik@sankuru.biz
# Commissioned at peopleperhour.com 
# Licensed under the GPL
#------------------------------------------------------------
group=$1

if [ "$group" = "" ] ; then
	echo "group argument required" >&2 
	exit 1
fi

groupFile="/var/lock/indiestor/$group"

if [ ! -f $groupFile ]; then
	/usr/bin/touch $groupFile
else
	if [ "$(pgrep -f indiestor-inotify.php)" = "" ] ; then
		logger "indiestor-touch: indiestor-inotify.php not running; removing stale lock"
		rm -f $groupFile
		/usr/bin/touch $groupFile
	else
		logger "indiestor-touch: indiestor-inotify.php running; skipping"
	fi
fi

