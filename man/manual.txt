.\" Process this file with
.\" groff -man -Tascii indiestor.1
.\"
.TH indiestor 1 "OCT 2012" Linux "User Manuals"
.SH NAME
indiestor - Project & MXF media sharing for Avid Media Composer
.SH SYNOPSIS
.B indiestor
 --volumes [-show -purge-fstab-backups]

 --volume [<arg> -quota-on -quota-off -quota-remove]

 --groups [-show]

 --group [-add -delete -show-members]

 --users [-show -show-incrontab -regenerate-incrontab]

 --user [<arg> -add -delete -expel -set-home <arg> -remove-home -set-group <arg> -unset-group -set-quota <arg> -remove-quota -set-passwd <arg> -lock -add-to-samba]

 --user [<arg> -remove-from-indiestor -remove-from-samba]

 --help
.SH DESCRIPTION
indiestor provides a complete open source solution for Avid project & MXF media sharing. It takes care of the management of volumes, groups and users (homes, passwords, quotas). Incron is used to trigger the sharing of projects and the patching of Avid MXF media folders.

As such  there is no requirement for a convoluted client side application. In turn, this ensures a shallow learning curve for editors.

To trigger sharing the editor must name (or rename) any folder on the top level of his/her home directory accordingly:

For avid shared projects use:
.B
 <projectname>.avid

For AMA volumes, legacy style FCP projects or anything else use:
.B
 <foldername>.shared

In the case of avid shares, upon detecting the
.B .avid
trigger indiestor will automatically create a
.B .copy
version of the project for all collaborating editors in the group. At this point the relevant MXF media is automatically patched (read only) to the other users of the group.

For each project bins can be easily exchanged between editors via a network of "shared" folders, which read-only to group permission for protection. Upon opening another editors bin it is advised that editors simply drag clips and sequences to their own bins for modification/IN/OUT etc.

.B NB:
In indiestor  v.1.0  users can only be a member of one group at a time. All users in a group will share all projects. The project owner can unshare a project by removing the share trigger.  For example, by renaming the folder "mydocumentary.avid" to "mydocumentary", the project owner will have removed the ".avid" trigger. This will cause indiestor to unshare the "mydocumentary" project. When unsharing a project, Indiestor will archive the members' work in the project owner's folder in the "Archived" subfolder.
.SH OPTIONS
There are seven main entities on which indiestor operates:

.B --volumes, --volume, --groups, --group, --users, --user, --help

A command consists in executing an action on an entity. For example, showing all users is done using either of the following:

.B indiestor --users -show

.B indiestor -show --users

All supported entity/action options are listed below:

.IP --volumes

.B -show:
Shows the list of volumes.

.B -purge-fstab-backups:
When enabling quotas, the system modifies the
.B /etc/fstab
file. It will create a dated backup of the existing version of
.B /etc/fstab
in the
.B /etc
folder. Use this action to purge all such backups.

.IP --volume <arg>

The
.B <arg>
argument is the volume name.

Example:
.B /dev/hda1
or
.B /dev/sda1
or other devices available on the system.

.B -quota-on:
Switches on the quota system for the volume.

.B -quota-off:
Switches off the quota system for the volume.

.B -quota-remove:
Removes the entry in
.B /etc/fstab
that enables the quota system for the volume and removes the
.B quota.user
file in the root of the volume's file system.

.IP --groups

.B -show:
Shows the list of indiestor groups. Not all groups listed in
.B /etc/group
are indiestor groups. 

.IP --group <arg>
 
The
.B <arg>
argument must be an indiestor group.

.B -add:
creates a new indiestor group.

.B -delete:
deletes the named indiestor group.

.B -show-members:
shows the users in the named indiestor group.

.IP --users

.B -show:
shows the list of indiestor users.

.B COLUMNS

.B 	user: 
username

.B 	home: 
home directory for the user

.B 	locked: 
Y=yes, N=no

.B 	group: 
indiestor group for the user*

.B 	quota: 
in gigabytes

.B 	used: 
gigabytes of quota used

.B 	%used:
percentage of quota used up

.B 	samba: 
Y=has samba access, N=does not have samba access

.B 	flags: 
samba flags. Normally U=user.

.B 	conn.: 
Currently connected through samba. Y=yes. N=no.

	*none if the user does not belong to an indiestor group.

.B -show-incrontab:
shows the list of folders being watched by incron for the user indienotify. See incrontab for the meaning of the columns.

.B  -regenerate-incrontab:
for debugging purposes. If the incrontab seems inconsistent, regenerate it.

.IP --user
.B <arg>

The
.B <arg>
argument must be an indiestor username.

.B -add: 
adds the user named to indiestor. If the user account does not exist, indiestor will create it. If the user exists, but is not an indiestor user, indiestor will add the user to the "indiestor-users" group. By default, indiestor also adds the user to Samba.

.B -delete:
removes the user named from indiestor.

.B -expel:
forcibly logs out the user named from the system.

.B -set-home <arg>:
sets the home directory for the user named to <arg>.

.B -remove-home:
only used in conjuction with the -delete action. In addition to deleting the user account, this option also deletes the user's home folder.

.B -set-group <arg>:
sets the group for the user named to the indiestor group <arg>. This indiestor group must exist already.

.B -unset-group:
removes the user named from his/her current indiestor group.

.B -set-quota  <arg>:
sets the quota for the user named to <arg> gigabytes. Must be a valid number of gigabytes.

.B -remove-quota:
removes the quota for the user and makes his/her quota unlimited.

.B -set-passwd <arg>:
sets the user's password to <arg>.

.B -lock:
locks the account for the user named. This prevents the user from logging in or connecting through samba. The samba flags will contain the "D" flag. The system locks the user by writing "!" in front of the password field of the user's record in the file
.B /etc/shadow
.You can unlock the account by setting the password again with the -set-passwd <arg> action.

.B -add-to-samba:
Adds an existing user to samba. 

.IP --user <arg>
.B -remove-from-indiestor:
Removes the user <arg> from indiestor. This action cannot be combined with other actions.

.IP --user <arg>
.B -remove-from-samba:
Removes the user <arg> from samba. This action cannot be combined with other actions.

.IP --help Shows the command the synopsis.


.SH EXAMPLES
It is possible to combine multiple actions for the same entity.

For example:

.B indiestor --user john -add -set-group grp1 -set-quota 20 -passwd hello

The command above adds the user "john" to indiestor, to the group "grp1", sets his/her quota to 20 gigabytes and his/her password to "hello". By default, the system will create john's home folder in
.B /home/john
. You can override this default by using the -set-home <arg> option.

.SH FILES
.I /etc/passwd
.RS
This is where the system stores the user records. There is a special user indienotify, which monitors the filesystem through incron.
.RE
.I /etc/group
.RS
This is where the system stores the group records. All indiestor users are registered in the indiestor-users group.
For example, all users for indiestor group "grp1" are registered in the "is_grp1" group. The "is_" prefix stands for "indiestor". special group: The indiewheel group lists the users that are allowed to execute the indiestor command besides the root user.
.RE
.I /etc/incron.allow
.RS
Must list the indienotify user. The indienotify user is the user for which incron watches the filesystem.
.RE
.I /var/spool/incron/indienotify
.RS
The incron table for the indienotify system user. The indiestor and indiestor-inotify commands regenerate this table as needed as a consequence of admin actions or as a consequence of changes in the filesystem monitored. In case of issues, use the --users -regenerate-incrontab option to regenerate this file. You can show the content of the file with the option --users -show-incrontab.
.RE
.I /etc/super.tab
.RS
This file must have an entry for the indiestor and indiestor-inotify command ensuring that the indiewheel group can operate the indiestor command as root and the indienotify user to operate the indiestor-inotify command as root.

Use:

.B sudo usermod -a -G indiewheel <username>

.RE
.I /etc/samba/smb.conf
.RS
Must list an indiestor share with valid users in the indiestor-users group. SMB must be configured for
.B "security=user"
type authentication.

The following global and share entries are required:

.B [global]
 security = user
 unix extensions = no

.B [indieSTOR]
 comment = IndieSTOR home directories 
 browseable = no
 writeable = yes
 path = %H
 hide files = /.*/DesktopFolderDB/TrashFor%m/resource.frk/
 veto = /.*/DesktopFolderDB/TrashFor%m/resource.frk/
 follow symlinks = yes
 valid users = @indiestor-users
 wide links = yes
 map read only = permissions
 inherit permissions = yes

.RE
.I /var/lib/samba
.RS
Indiestor automatically keeps the users and passwords for the indiestor-users group in sync with samba's users and passwords.
.RE
.I /var/log/syslog:
.RS
indiestor-inotify logs its operations to this file, which is the system log file. You can inspect it with the command:
.RE
.I /etc/fstab
.RS
Indiestor modifies this file to enable quota, by adding or removing the usrquota attribute to the volume being subjected or relieved from the use of user quota.
.RE
.I /etc/shadow
.RS
The system stores the user passwords in this file.
.RE
.I quota.user
.RS
Quota file in the root of the filesystem for the volume for which the quota system has been enabled.
.RE
.SH MISCELLANEOUS NOTES

.B Connecting Mac clients to indiestor:
Users should switch to Finder and use Command + K or click Go > connect to server:

smb://xxx.xxx.xxx.xxx/indiestor

Mac users on 10.6.8 (Snow Leopard) are advised to use the replacement Thursby Dave SMB client to satisfy the needs of Avid Media Composer. We strongly recommend you test this before purchasing Dave. The newer Apple SMBx samba client (released in 10.7.x and newer) may work properly, depending on OS build, however for performance and reliability we also recommend Dave for Lion and Mountain Lion users.

.B Connecting Windows clients to indiestor:
For windows use the built in CIFS/SMB client. Go "Computer" > Map Network Drive:

\e\exxx.xxx.xxx.xxx\eindiestor

.B Enable Avid "All Drives":
this option must be enabled on all client Media Composer workstations, since it enables Media Composer to use NAS based network drives to store media. You can toggle this on/off by starting Media Composer, loading a temporary project, click Tools > Console and type "alldrives 1".

The Avid console should respond with:
 "All drives will be viewed as media drives"

This only has to be set once on each workstation.

.B Media Creation Settings:
Please take care to ensure Avid "media creation" settings reflect the use of the indiestor drive.
.SH DIAGNOSTICS

.B GENERAL DIAGNOSTIC INFORMATION:
You can find the complete list error messages triggered by indiestor including their description in the file:

.B /usr/share/indiestor/admin/arg-definitions/noticeDefinitions.conf



.B ISSUE: Avid Exception Error
- EXCEPTION: DISK_ACCESS_ERROR

.B FIX:
Occurs within the Media Composer application when attempting to move a bin into another users "shared" folder. Due to permissions write is not permitted. In both MC 5.0.x and 5.5.x this has been observed to cause a segmentation fault (application crash), usually some minutes after the event. Essentially there is no direct fault with indiestor, but documented here for sanity. MC 6.x and newer appears to be robust to this occurrence.



.B ISSUE: super indiestor -
Permission denied to user username

.B FIX:
User is must be added to /etc/super.tab



.B ISSUE: Stale SMB Mount Points
- indiestor(<number>)

.B FIX:
This issue is a Mac only.

Occasionally Dave will connect mount points with a number appended to the name. This issue is caused by "stale" mount points and relates directly to Thursby Dave.

Downstream of Dave this can cause issues with the indiestor workflow, particularly with ".shared" AMA volumes, as the path becomes inconsistent between users.

In the event of stale mount points simply delete the detached "indiestor" mount point folder from /Volumes/ (This task must NOT be performed while connected)

See: http://www.thursby.com/forum/viewtopic.php?f=10&t=262
.SH AUTHOR
Alex Gardiner (alex@indiestor.com) & Erik Poupaert (erik@sankuru.biz)

