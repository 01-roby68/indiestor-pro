#!/bin/sh
#------------------------------------------------------------
# Indiestor Pro program
# Concept, requirements, specifications, and unit testing
# By Alex Gardiner, alex@indiestor.com
# Written by Erik Poupaert, erik@sankuru.biz
# Commissioned at peopleperhour.com 
# Licensed under the GPL
#------------------------------------------------------------
avidReport=$(indiestor-pro --avid-workspaces -show)
genericReport=$(indiestor-pro --generic-workspaces -show)

zfsInstalled=$(which zpool)
if [ "$zfsInstalled" = "" ] ; then
        zfsReport="no"
else
        zfsStatus=$(zpool status -x 2>&1)
        if [ "$zfsStatus" = "all pools are healthy" ] ; then
                zfsReport="yes"
        elif [ "$zfsStatus" = "no pools available" ] ; then
                zfsReport="no"
        else
                zfsReport="yes"
        fi
fi

hostname=$(hostname)

report=""
report="${report}Indiestor report\n"
report="${report}================\n"
report="${report}machine: $hostname\n\n"
report="${report}Avid workspaces\n"
report="${report}---------------\n"
report="${report}${avidReport}\n\n"
report="${report}Generic workspaces\n"
report="${report}------------------\n"
report="${report}${genericReport}\n\n"
if [ ! "$zfsStatus" = "NO-REPORT" ] ; then
        report="${report}ZFS\n"
        report="${report}---\n"
        report="${report}$zfsStatus\n"

echo $report
fi

